<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/main :: layout(~{::section})}">

<section>

    <h2 class="mb-4 d-flex justify-content-between align-items-center">
        <span>帳號管理</span>
        <a class="btn btn-sm btn-dark" th:href="@{/users/create}">
            新增
        </a>
    </h2>

        <nav class="navbar bg-body-tertiary">
            <div class="container-fluid d-flex justify-content-between align-items-center">
                <form class="d-flex mb-0 flex-grow-1 me-3" 
                      th:action="@{/users}" 
                      method="get" 
                      role="search">
        
                    <input class="form-control me-2" type="search" placeholder="帳號/權限" aria-label="Search" name="q"
                        th:value="${keyword}" />
                    <button class="btn btn-outline-success" type="submit">search</button>
                    <a th:href="@{/users}" class="btn btn-clear">Clear</a>
                </form>
                
                <div class="dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        狀態
                    </a>
                    
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" th:href="@{/users/status}">全部</a></li>
                        <li><a class="dropdown-item" th:href="@{/users/status(enabled=true)}">啟用</a></li>
                        <li><a class="dropdown-item" th:href="@{/users/status(enabled=false)}">停用</a></li>
                    </ul>
                </div>
               
            </div>
        </nav>

    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead>
                <tr>
                    <th>帳號</th>
                    <th>姓名</th>
                    <th>Email</th>
                    <th>權限</th>
                    <th>啟用</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="u : ${users}">
                    <td th:text="${u.userName()}"></td>
                    <td th:text="${u.fullName()}"></td>
                    <td th:text="${u.email()}"></td>
                    <td th:text="${u.role()}"></td>
                    <td>
                        <span th:text="${u.enabled()} ? '是' : '否'"></span>
                    </td>
                    <td>
                        <a class="btn btn-sm btn-outline-dark" 
                            th:href="@{/users/{userName}/status(userName=${u.userName()})}"
                            th:text="${u.enabled()} ? '停用' : '啟用'">
                        </a>
                    </td>
                    <td>
                        <a class="btn btn-sm btn-outline-primary" th:href="@{/users/{userName}/edit(userName=${u.userName()})}">
                            變更
                        </a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(users)}">
                    <td colspan="7" class="text-center text-muted">
                        目前沒有用戶資料
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div th:replace="~{fragments/pagination :: pagination(${users}, '/users', ${keyword}, ${type}, ${startDate}, ${endDate})}"></div>

</section>

</html>