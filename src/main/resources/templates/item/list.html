<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/main :: layout(~{::section})}">

<section>

    <h2 class="mb-4 d-flex justify-content-between align-items-center">
        <span>商品清單</span>
        <div sec:authorize="hasAnyRole('MANAGER', 'OPERATOR')" class="mt-3">
            <a class="btn btn-sm btn-dark" th:href="@{/items/create}">
                新增
            </a>
        </div>
        
    </h2>

    <nav class="navbar bg-body-tertiary">
        <div class="container-fluid  d-flex justify-content-between align-items-center">
            <form class="d-flex mb-0 flex-grow-1 me-3" 
                  th:action="@{/items}"
                  method="get"
                  role="search">
                
                <input class="form-control me-2" 
                       type="text" 
                       placeholder="編號/品名/sku/廠商" 
                       aria-label="Search" 
                       name="q"
                       th:value="${q}"/>
                <button class="btn btn-outline-success" type="submit">search</button>
                <a th:href="@{/items}" class="btn btn-clear">Clear</a>
            </form>

            <div>
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <span th:text="${enabled == null ? '狀態：全部' : (enabled ? '狀態：啟用' : '狀態：停用')}">
                        狀態：全部
                    </span>
                </a>
                
                <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <a class="dropdown-item" 
                           th:classappend="${enabled == null} ? ' active' : ''" 
                           th:href="@{/items/status}">全部</a>
                    </li>
                    <li>
                        <a class="dropdown-item" 
                           th:classappend="${enabled == true} ? '  active' : ''"
                           th:href="@{/items/status(enabled=true)}">啟用</a>
                    </li>
                    <li>
                        <a class="dropdown-item" 
                           th:classappend="${enabled == false} ? ' active' : ''"
                           th:href="@{/items/status(enabled=false)}">停用</a>
                    </li>
                </ul>
            </div>
            
        </div>
    </nav>

    <div class="table-responsive">
        <table class="table table-striped table-hover table table-striped table-hover align-middle">
            <thead>
                <tr>
                    <th>商品編號</th>
                    <th>SKU</th>
                    <th>品名</th>
                    <th>酒類型</th>
                    <th>產地</th>
                    <th>年份</th>
                    <th>容量(ml)</th>
                    <th>庫存</th>
                    <th>啟用</th>
                    <th>廠商編號</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <!-- 空狀態 -->
                <tr th:if="${items == null or items.totalElements == 0 }">
                    <td colspan="11" class="text-center text-muted">
                        查無商品資料
                    </td>
                </tr>

                <!-- 有資料 -->
                <tr th:each="item : ${items.content}">
                    <td th:text="${item.itemId()}"></td>
                    <td th:text="${item.sku()}"></td>
                    <td th:text="${item.name()}"></td>
                    <td th:text="${item.wineType()}"></td>
                    <td th:text="${item.originCountry()}"></td>
                    <td th:text="${item.vintage != null ? item.vintage() : '-'}"></td>
                    <td th:text="${item.volumeMl()}"></td>
                    <td th:text="${item.stock()}"></td>
                    <td>
                        <span th:text="${item.enabled()} ? '是' : '否'"></span>
                    </td>
                    <td> 
                        <a th:text="${item.supplierId()}" th:href="@{'/suppliers/' + ${item.supplierId()}}"></a>
                    </td>
                    <td>
                        <a class="btn btn-sm btn-outline-dark" th:href="@{/items/{id}(id=${item.itemId()})}">
                            詳情
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

<div th:replace="~{fragments/pagination :: pagination(${items}, '/items', ${q}, ${enabled}, ${null}, ${null})}"></div>

</section>

</html>